#! /bin/sh

echo "This is an automated activity report from OpenSSL."
echo "A follow-up, if any, will call out particular highlights."

echo ""
echo Since $1, the team has made `wc -l <team.full` commits.

(
echo ""
echo We have made the following releases.  Note that there are sometimes
echo gaps, because some CVE notices reference old releases which had
echo already gone out.
) | fmt
for R in 1.1.0 1.0.2 1.0.1 ; do
    grep $R <releases.txt | fmt | sed -e 's/^/    /'
done

WC=`cat issues.csv pulls.csv | awk -F, '{print $6;}' | sort -u | wc -l`
ISS=`grep -c open <issues.csv`
PR=`grep -c open <pulls.csv`
(
echo ""
echo On GitHub, $WC unique users created $ISS new issues and $PR new pull requests.

ISS=`grep -c closed <issues.csv`
PR=`grep -c closed <pulls.csv`
echo "The team closed $ISS issues and closed (usually merged) $PR PRs."
echo "(Note that the we often create our own PR's in order to leverage the"
echo "CI tools we available there.)"
) | fmt

(
echo ""
echo "The tables below are CSV format so that they can easily be cut and pasted"
echo "into a spreadsheet."
) | fmt

(
echo ""
echo We have addressed the following CVE\'s.  We remind you that
echo 1.0.1 goes end of life at the end of 2016.
) | fmt
echo "date,     name,          sev,  rel110, rel102, rel101"
cat cve.txt

(
echo ""
echo Here are the number of bugs opened and closed, and the total open bugs
echo on a monthly basis:
) | fmt
cat bugs.csv

echo "This report was generated by the tools found here:"
echo "     https://github.com/richsalz/activityreports"
